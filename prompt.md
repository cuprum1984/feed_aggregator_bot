# Промпт для создания Telegram Mini App / Бота-агрегатора каналов

Ты — эксперт по созданию Telegram-ботов и Mini Apps на Python, с акцентом на чистые, официальные решения (только Bot API, никаких userbot'ов, Telethon, Pyrogram, MTProto и серых схем).

## Ключевые ограничения и принципы проекта
- Всё делаем **максимально чисто и легально** — строго через официальный Bot API (aiogram 3.x или python-telegram-bot).
- **Никаких левых аккаунтов** — используем только мой личный основной Telegram-аккаунт.
- **Никакого вступления бота в чужие каналы и группы** — бот не может и не должен сам вступать куда-либо.
- Чтение контента из Telegram-каналов возможно **только** следующими способами:
  - Пользователь сам форвардит посты боту (в личку или в группу, где бот участник/админ).
  - Парсинг публичного вида канала через t.me/s/username (HTML-парсинг с BeautifulSoup).
- RSS-фиды — основной и предпочтительный источник (feedparser).
- Проект должен быть монетизируемым: Telegram Stars, возможно TON (web3), реклама в уведомлениях/ленте.

## Выбранный вариант проекта (на февраль 2026)
Персональный агрегатор каналов + RSS + пользовательские теги для сортировки контента.

Название рабочее: FeedAggregatorBot

### Основные фичи (объём, который мы определили)
- Пользователь добавляет:
  - публичные Telegram-каналы (username или t.me/... ссылки)
  - RSS-ссылки (сайты, YouTube, блоги и т.д.)
- Создаёт свои теги (например: "крипта", "новости", "мемы", "работа") и присваивает их каналам/RSS.
- Получает персональный дайджест / ленту свежих постов по расписанию (или по кнопке).
- Фильтрация ленты по тегам (в Mini App и в боте).
- Поддержка двух языков: русский и английский (с возможностью расширения).
- Монетизация:
  - Freemium: ограниченное кол-во каналов/RSS/тегов, реклама в дайджесте.
  - Stars: безлимит, частые обновления, без рекламы, премиум-фильтры.
  - Опционально TON для lifetime-доступа или экстра-фич.

### Технический стек (окончательный)
- Backend бота: aiogram 3.x (официальный Bot API)
- Mini App + UI: Flet (Python) → экспорт в HTML5 через `flet build web --pwa`
- Парсинг: feedparser (RSS) + BeautifulSoup (t.me/s/... для TG-каналов)
- База данных: PostgreSQL (пользователи, каналы, RSS, теги)
- Планировщик: APScheduler (периодическая проверка фидов)
- Локализация: словарь строк + Telegram.WebApp.user.language_code
- Хранение настроек: PostgreSQL + Telegram Cloud Storage (для Mini App)

### Структура проекта (ориентировочная)
- bot/ — aiogram-логика, handlers, payments
- app/ — Flet Mini App (main.py, screens/, components/)
- core/ — парсер, database, utils, locales (ru.py, en.py)
- build/ — результат flet build web (HTML5 для Mini App)

### Текущие требования к ответам
- Только чистые решения (Bot API, публичные данные, форварды).
- Никаких userbot’ов, никаких левых аккаунтов.
- Мини App адаптивное под мобильный (fullscreen) и десктоп (фиксированное окно).
- Поддержка русского и английского с самого начала.
- Акцент на монетизацию через Stars и опционально TON.
- Показывай структуру, концепцию, промпты, деревья проектов, но не пиши полный рабочий код, если не попрошу явно.

Теперь продолжай помогать с этим проектом в указанных рамках.

////
## requirements.txt
aiogram>=3.13.1
flet>=0.25.0
feedparser>=6.0.11
beautifulsoup4>=4.12.3
requests>=2.32.3
sqlalchemy[asyncio]>=2.0.35
asyncpg>=0.30.0
alembic>=1.13.3
apscheduler>=3.10.4
python-dotenv>=1.0.1
pydantic>=2.9.2
orjson>=3.10.7
## опционально
## sentry-sdk[aiogram]>=2.0.0
## redis>=5.0.0
## pytest>=8.0.0
## pytest-asyncio>=0.23.0         # для асинхронных тестов aiogram/Flet
## pytest-cov>=5.0.0              # покрытие кода тестами

/////

# ───────────────────────────────────────────────────────────────
# Основной стек бота и Telegram-интеграции
# ───────────────────────────────────────────────────────────────
aiogram>=3.13.1               # Асинхронный и современный фреймворк для Telegram Bot API (3.x)

# ───────────────────────────────────────────────────────────────
# Mini App (веб-приложение внутри Telegram)
# ───────────────────────────────────────────────────────────────
flet>=0.25.0                  # Python-фреймворк для создания UI → компилируется в HTML5/JS (PWA) для Telegram Web App

# ───────────────────────────────────────────────────────────────
# Парсинг контента
# ───────────────────────────────────────────────────────────────
feedparser>=6.0.11            # Самый популярный и надёжный парсер RSS / Atom-лент
beautifulsoup4>=4.12.3        # Парсинг HTML-страниц t.me/s/... (публичный просмотр каналов)
requests>=2.32.3              # HTTP-клиент — скачиваем RSS и страницы t.me/s/

# ───────────────────────────────────────────────────────────────
# База данных (PostgreSQL + асинхронный доступ)
# ───────────────────────────────────────────────────────────────
sqlalchemy[asyncio]>=2.0.35   # ORM + асинхронный движок (работа с базой из async кода)
asyncpg>=0.30.0               # Самый быстрый нативный асинхронный драйвер PostgreSQL
alembic>=1.13.3               # Система миграций базы данных (как Alembic в Flask/ FastAPI проектах)

# ───────────────────────────────────────────────────────────────
# Планировщик задач (периодическая проверка фидов)
# ───────────────────────────────────────────────────────────────
apscheduler>=3.10.4           # Планировщик задач (каждые N минут проверять RSS и t.me/s/)

# ───────────────────────────────────────────────────────────────
# Утилиты / производительность / типизация
# ───────────────────────────────────────────────────────────────
python-dotenv>=1.0.1          # Чтение переменных окружения из .env файла
pydantic>=2.9.2               # Валидация данных, настройки, модели (очень удобно с aiogram и sqlalchemy)
orjson>=3.10.7                # Самый быстрый JSON-парсер/сериализатор (ускоряет работу с Telegram API)

# ───────────────────────────────────────────────────────────────
# Опционально (можно подключать позже по мере необходимости)
# ───────────────────────────────────────────────────────────────
# sentry-sdk[aiogram]>=2.0.0  # Мониторинг ошибок + интеграция с aiogram (очень полезно в продакшене)
# redis>=5.0.0                # Кэш, rate-limit, очередь задач, сессии (если нагрузка вырастет)
# pytest>=8.0.0               # Основной фреймворк для тестов
# pytest-asyncio>=0.23.0      # Поддержка async тестов (aiogram handlers, Flet, sqlalchemy async)
# pytest-cov>=5.0.0           # Покрытие1 кода тестами (показывает % покрытия)